# Benchmarky a zátěžové testy

- **benchmarkování** je porovnání systémů na základě charakteristik, které jsou problémové
- klíčová citace: **„Lži, zatracené lži a statistika“ (Mark Twain)**

### Typy testů

- **Benchmark**
	- měření výkonu při normálních podmínkách
	- výstup: doba odezvy, počet zpracovaných úloh, vytížení zdrojů
- **Load Test**
	- test chování systému při postupně zvyšovaném zatížení
	- výstup: výkonnostní ukazatele a stabilita
- **Stress Test**
	- ověřuje chování systému při přetížení (např. restart databáze)
	- výstup: popis selhání a akce pro zotavení

### Cíle a výhody testování

- **Porovnání systémů** – určení nejlepšího systému pro dané zatížení
- **Nastavení systému** – optimalizace konfigurace pro lepší využití zdrojů
- **Nalezení úzkých míst** – identifikace oblastí pro zlepšení
- **Plánování kapacity** – odhad maximálního počtu uživatelů a chování při přetížení
  
### Typické problémy se zátěží

- **Souběhové chyby** – problémy se projevují při souběhu více instancí
- **Databáze** – indexy a zámky
- **Konfigurace** – dostupné zdroje, povolené počty spojení, limity, ...
- **Paměť** – zbytečné alokace a nedostatek paměti
- **Infrastrukturní** – šířka pásma, diskové operace, externí služby
  
### Metriky

- **Rychlost** – doba odezvy, počet operací
- **Spolehlivost** – pravděpodobnost chyby, střední doba do poruchy (MTTF)
- **Dostupnost** – čas mezi událostmi a jejich trvání, počet paketů za sekundu
- **Cena** – náklady na transakci, spotřeba, tepelný výkon

### Základní vlastnosti testování

- **Opakovatelnost** – kontrolované podmínky a měřitelné výsledky
- **Eliminace vnějších vlivů** – zohlednění okolních podmínek

### Dělení benchmarků

1. program pro testování
2. reálné programy
3. klíčové části reálných programů
4. syntetické benchmarky
5. specifické algoritmy

### Syntetické benchmarky pro CPU

- **Whetstone** (1972): měří výkon přes aritmetiku v plovoucí řádové čárce
- **Dhrystone** (1984): realističtější metrika výkonnosti pro celá čísla

### Moderní benchmarky

- různé balíky pro testování CPU, paměti, úložišť a webových aplikací
- např. **SPEC, TPC-C, Apache JMeter**

### Návrh experimentu

- stanovení cílů s minimálním úsilím pro maximální získané informace
- určení metrik a popisu testovaného systému

### Určení cílů

- cíle testování ovlivňují výběr testů a interpretaci výsledků

### Spolehlivostní metriky

- **Spolehlivost** – pravděpodobnost bezchybného chodu
	- **Střední doba mezi chybami (MTBF)** – průměrná doba mezi poruchami
- **Dostupnost** – procento času, kdy je systém funkční
	- **Střední doba do selhání (MTTF)** – průměrná doba do prvního selhání
	- **Střední doba do opravy (MTTR)** – průměrná doba potřebná k opravě

+ **Výkon**
	- počet přijatých účtenek za jednotku času
	- doba pro získání aktualizace (závisí na počtu položek)
+ **Spolehlivost**
	- poměr úspěšně odeslaných k odmítnutým účtenkám
	- důvody selhání a jejich typ (systematické vs. dočasné)

### Parametry a faktory

- **Parametry systému**
  – stále hodnoty (např. HW, nastavení DB)
- **Parametry zátěže**
  – charakteristiky uživatelských požadavků (např. struktura účtenky, velikost aktualizací)
- **Faktory**
  – měnitelné hodnoty, které ovlivňují výkon systému (např. počet uživatelů)

### Zátěž

- může vycházet z analytických modelů nebo simulací
- **skripty** – napodobují chování uživatelů, které vytvářejí konstantní nebo měnící se zátěž

+ **statistické modely** – histogramy, Markovské modely, clustering pro rozdělení zátěže
+ pozor na vliv externích komponent (např. API), které mohou ovlivnit výsledky testování

Příklady

- skript, který odesílá účtenky nebo vyžaduje aktualizace
- analyzovat otázky jako frekvence požadavků a ukládání dat pro analýzu

### Analýza výsledků

- používat statistické pojmy jako průměry, percentily a rozptyl k popisu údajů
- vizualizace výsledků by měla být jasná a srozumitelná pro cílové publikum

### Přehled vizualizace

- zkreslené grafy a nevhodného měřítka mohou vést k chybným závěrům
- **radarové grafy** – užitečné pro popis více metrik, ale pozor na odlišnosti hodnot
