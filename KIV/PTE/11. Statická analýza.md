# Statická analýza

- **Cíl**: automaticky odvodit chování programu ze zdrojového textu nebo binárního souboru
- **Omezení**: úplná analýza není možná (Halting problem)
- **Požadavek**: žádné složité techniky – symbolické ani konkolické vykonávání
- **Výhoda oproti překladači**: odhalí více informací než běžná kompilace

### Co se dá zjistit? / Možnosti a omezení
| Oblast               | Co lze (přibližně)                                  | Typické omezení                        |
| -------------------- | --------------------------------------------------- | -------------------------------------- |
| **Typová kontrola**  | statická typová kontrola podle jazykových pravidel  | neúplná – může vést k false‑positivům  |
| **Metriky**          | složitost kódu, cyklomatická komplexita             | závisí na přesnosti CFG/AST            |
| **Optimalizace**     | detekce mrtvého kódu, redundantních výpočtů         | může vyžadovat kontext (např. reflexe) |
| **Kontrola stylu**   | dodržení konvencí (MISRA, Java‑style)               | často heuristické                      |
| **Antipatterny**     | hledání známých špatných konstrukcí                 | false‑positivy u složitých vzorů       |
| **Verifikace**       | @NotNull nikdy nevrátí `null`, zdroje jsou uzavřeny | nutnost anotací / externích kontraktů  |
| **Model generation** | automatické vytváření modelů pro model‑checking     | omezeno na část kódu                   |

### Riceův teorém (1953)

- Každá netriviální semantická vlastnost programu v univerzálním jazyce je nerozhodnutelná.
- analýzu lze převést na halting problém → obecně neřešitelná
- prakticky lze v konkrétních případech některé vlastnosti určit, ale vždy existuje riziko false‑positivů

### Nástroje (zdarma, aktivně udržované)

**Java**
- SpotBugs
- PMD
- CheckStyle
- SonarQube

**C/C++**
- Clang
- GCC
- cppCheck
- Cpplint
- Splint

### Analýza toku řízení (CFG) a dat (Data‑flow)

**Abstract Syntactic Tree** (AST)
- abstraktní syntaktický strom
- zachycuje strukturu programu

**Control Flow Graph** (CFG)
- orientovaný graf toku řízení, jednodušší než AST
- uzly jsou základní bloky (posloupnost instrukcí, bez skoků)
- větvení přes if, for, while

**Derivační strom** (Parse tree)
- reprezentace vstupu získaná parserem (syntaktickým analyzátorem)
- řada nepodstatných uzlů
- v AST reprezentace programu – tedy jen důležité věci z Parse tree

#### Data‑flow analýza

- založena na CFG, sleduje skoky, přiřazení a testy výjimek
- **Cíl:** sledovat šíření dat (proměnných, výrazů) programem
- **Využití:**  
	- analýza dostupnosti výrazů (optimalizace)
	- analýza živých proměnných (eliminace mrtvého kódu)

### Kvalita analýzy – Soundness vs Completeness

- **Soundness** (korektnost): pokud analýza tvrdí, že vlastnost platí, platí ve všech možných bězích programu
- **Completeness** (úplnost): analýza zachytí všechny relevantní cesty/kombinace; v praxi často nedosažitelná, což vede k false‑positivům nebo false‑negativům
- **Správnost** (correctness): obojí dohromady

### Co lze statickou analýzou zjistit?

| Kategorie          | Typy chyb / informací                                                        |
| ------------------ | ---------------------------------------------------------------------------- |
| Datové toky        | neinicializované proměnné, mrtvý kód, nepoužité proměnné, zbytečná přiřazení |
| Řízení toku        | potenciální dělení nulou, nekonečné smyčky, tautologie/kontradikce           |
| API kontrakty      | porušení `@NotNull/@Nullable`, špatné volání API, neuzavřené zdroje          |
| Paměť a bezpečnost | přístup mimo mezí pole, use‑after‑free, dvojité uvolnění, neplatné ukazatele |
